<!DOCTYPE html>
<html lang="zh-cn">
<head>
  
    <title>区块链技术概述 :: Utop&#39;s Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="图1. 区块链简单结构
图2. 单个区块的抽象结构
"/>
<meta name="keywords" content="BLOG"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://dormouse-none.github.io/posts/2018-03-01-%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/" />


<link rel="stylesheet" href="https://dormouse-none.github.io/assets/style.css">

  <link rel="stylesheet" href="https://dormouse-none.github.io/assets/blue.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dormouse-none.github.io/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="https://dormouse-none.github.io/favicon.ico">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="区块链技术概述 :: Utop&#39;s Blog — " />
<meta name="twitter:description" content="图1. 区块链简单结构
图2. 单个区块的抽象结构
" />
<meta name="twitter:site" content="https://dormouse-none.github.io/" />
<meta name="twitter:creator" content="fangfeng" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="zh-cn" />
<meta property="og:type" content="article" />
<meta property="og:title" content="区块链技术概述 :: Utop&#39;s Blog — ">
<meta property="og:description" content="图1. 区块链简单结构
图2. 单个区块的抽象结构
" />
<meta property="og:url" content="https://dormouse-none.github.io/posts/2018-03-01-%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/" />
<meta property="og:site_name" content="区块链技术概述" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2018-03-01 00:00:00 &#43;0000 UTC" />










<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92258941-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', "UA-92258941-1");
</script>



</head>
<body class="">


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    ffutop
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">关于</a></li>
        
      
        
          <li><a href="/archives">归档</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">关于</a></li>
      
    
      
        <li><a href="/archives">归档</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://dormouse-none.github.io/posts/2018-03-01-%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/">区块链技术概述</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2018-03-01
    </span>
    
    
    <span class="post-author">::
      fangfeng
    </span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://dormouse-none.github.io/tags/blockchain/">BlockChain</a>&nbsp;
    
    #<a href="https://dormouse-none.github.io/tags/smart-contract/">Smart Contract</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    <p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fs8oc4ri7qj30mq055aap.jpg" alt="区块链简单结构" />
<center><small>图1. 区块链简单结构</small></center></p>

<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1foxcpmmpfhj31kw107n2e.jpg" alt="Merkle tree" /></p>

<p><center><small>图2. 单个区块的抽象结构</small></center></p>

<h2 id="基本工作流程">基本工作流程</h2>

<h3 id="新交易发起流程">新交易发起流程</h3>

<ol>
<li>用户通过公/私钥与区块链网络进行交互</li>
<li>处理用户交易的节点向网络邻节点广播用户交易</li>
<li>邻节点验证交易的有效性；可信，继续向其它邻节点广播；不可信，丢弃。</li>
</ol>

<h3 id="新区块产生流程">新区块产生流程</h3>

<ol>
<li>矿工尝试将一个时间区间内的交易进行打包形成新区块（怎么打包，看下文）</li>
<li>生产出新区块的矿工节点向网络广播新区块</li>
<li>收到新区块的网络节点验证该区块的有效性</li>
</ol>

<p><a href="https://blockchain.info/zh-cn">比特币区块浏览器</a>      更多<a href="https://en.wikipedia.org/wiki/Metric_prefix">国际单位制前缀</a></p>

<h2 id="网络共识">网络共识</h2>

<p>所有区块链网络节点需要对交易以及其在新区块里面的顺序达成一致（交易的有效性以及交易的打包顺序）。</p>

<p>可能出现：</p>

<ul>
<li>女巫攻击——单一实体以多重身份重复对新区块结果进行表决（少数人抓住了网络的投票权）</li>
<li><a href="https://zh.wikipedia.org/wiki/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98">拜占庭将军问题</a>——分布式对等网络的通信容错问题

<ul>
<li>不同的计算机通过通讯交换信息达成共识而按照同一套协作策略行动</li>
<li>成员计算机可能出错而发送错误信息</li>
<li>网络的不可靠性</li>
<li>从而影响网络共识的达成，破坏一致性。</li>
<li>不解决的话可能导致——区块链分叉</li>
</ul></li>
</ul>

<p>解决方案：</p>

<ul>
<li>工作量证明（proof-of-work, PoW），权益证明(proof-of-stake, PoS)，白名单机制（仅适用于私有网络）等</li>
<li>实用拜占庭容错算法</li>
</ul>

<h3 id="局限">局限</h3>

<p>网络共识机制的实现导致了：</p>

<ol>
<li>交易吞吐量</li>
<li>更高的交易时延。交易确认时间（只有打包的新区块中才交易才会被承认）。</li>
</ol>

<p>共识机制的伸缩可以一定程度上解决上述问题</p>

<h2 id="资产交易">资产交易</h2>

<p>简单交易状态描述，以集中式数据库为例</p>

<p>假设初始状态为</p>

<pre><code>-------------------------
| 资产类型 | 所有者 | 数量 |
-------------------------
|   CNY   |  防风  |  10 |
-------------------------
|   CNY   |  红薯  |  0  |
-------------------------
</code></pre>

<p>防风 向 红薯 转账 2 CNY</p>

<pre><code>-------------------------
| 资产类型 | 所有者 | 数量 |
-------------------------
|   CNY   |  防风  |  8  |
-------------------------
|   CNY   |  红薯  |  2  |
-------------------------
</code></pre>

<p>数据库中相应记录的更改完成了资产的交易过程。</p>

<p>在区块链中，仍然将分布式链看作是一个达成共识的集中式数据库</p>

<p>那么现在的初始状态可以表示成</p>

<pre><code>---------------------------------
| 资产类型 |     所有者     | 数量 |
---------------------------------
|   IOTA  |  防风 pub_key  | 10  |
---------------------------------
</code></pre>

<p>现在的所有者由公钥表示，想要修改记录必须提供对应的密钥。</p>

<p>例如，防风 向 红薯 转账 2 IOTA ，需要提供防风的私钥和红薯的公钥。交易记录修改结果：</p>

<pre><code>---------------------------------
| 资产类型 |     所有者     | 数量 |
---------------------------------
                                 被删除了         |   IOTA  |  防风 pub_key  | 10  |
---------------------------------
|   IOTA  |  红薯 pub_key  |  2  |
---------------------------------
|   IOTA  |  防风 pub_key  |  8  |
</code></pre>

<p>交易的概念流程：</p>

<ol>
<li>定位防风所有的资产记录行</li>
<li>删除该行前验证密钥</li>
<li>确认该记录没有被别的交易使用（双花问题，双重交易）</li>
<li>写入新的正确的记录（红薯获得的资产 &amp; 防风剩余的资产），确保交易前与交易后资产总额不变</li>
</ol>

<p>上面的模型 —— 基于比特币的交易模型(UTXO <em>model</em>)</p>

<p><strong>适合于数字标记资产的传输与追踪</strong></p>

<ul>
<li>概念：UTXO (unspent transaction outputs) 未花费的交易输出：数据库现有的记录</li>
</ul>

<p>-&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<p>另一种模型常用于智能合约 —— 基于账号的模型(account-based <em>model</em>)</p>

<p><strong>提供了建立多步骤执行的基本机制</strong></p>

<h3 id="资产如何产生">资产如何产生</h3>

<ul>
<li>比特币：

<ul>
<li>矿工节点允许在挖出的新节点中加入一种 coinbase 类型的交易（不存在交易输入，新资产数额有比特币链提前定义）</li>
</ul></li>
<li>在创始新代币的时候全额发行</li>
<li>其它机制</li>
</ul>

<h2 id="区块链特性">区块链特性</h2>

<ol>
<li>一种健壮的、真正的分布式对等系统，它能容忍节点故障。</li>
<li>能够识别冲突和分叉并自动解决的网络，以便收敛到单一的、公认的唯一状态。（区块链永远选择最长的分支来达成网络上的共识）</li>
<li>网络活动的透明性、可验证性、可审计性。我们能获取可验证的过程，无论它们是否交换和跟踪数字资产，还是数据驱动的交互。每一个行为，都存有公开的与网络交互的记录，并以此来消除人为的矛盾。</li>
<li>这是一种可以标记不同信息的触发者的方法，并且能够在没有中央权威的情况下强制执行。</li>
<li>这是一个使得不信任双方根据可预测的、确定性的方式交互的系统。</li>
</ol>

<h2 id="智能合约">智能合约</h2>

<p>自动化地执行一系列合约条款的交易协议</p>

<p>智能合约是存储在区块链中的脚本（认识上可以与关系型数据库的存储过程类似）。</p>

<p>以基于账号的模型为例对合约执行进行描述：</p>

<pre><code>假设定义一个合约，包括三个方法

(1) “存储”——合约的“存款”功能允许 防风（通过防风的密钥验证）将若干单位的X存入合约中；
(2) “交易”——“交易”功能允许任何人向合约发送5单位Y，并从合约持有的X中返回1单位给交易方；
(3) “撤销”——“撤销”功能允许 防风 取出合约中存有的所有资产。

	请注意，上述“存款”和“撤销”功能被限制为只允许被 防风（实际上是防风的私钥）调用。当然，这只有由于上述合约由防风制定。若人为的制定一个所有人都能调用任何功能的合约也是允许的（虽然这在事实上没有意义）。

</code></pre>

<p>那么在基于账户的模型下，可以认为 拥有“存储”、“交易”、“撤销”方法的合约持有一个单独的账户（与用户所持有的账户等价）。</p>

<p>在上述合约下，这个账户将可能持有一定数量的资产。除了只能按照预定的合约步骤对资产进行处置之外，其它与用户持有的账户别无二致。</p>

<pre><code class="language-text">  __                    __
 / _| __ _ _ __   __ _ / _| ___ _ __   __ _
| |_ / _` | '_ \ / _` | |_ / _ \ '_ \ / _` |
|  _| (_| | | | | (_| |  _|  __/ | | | (_| |
|_|  \__,_|_| |_|\__, |_|  \___|_| |_|\__, |
                 |___/                |___/
</code></pre>
  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <span class="button previous">
        <a href="https://dormouse-none.github.io/posts/2018-06-11-asm-classreader/">
          <span class="button__icon">←</span>
          <span class="button__text">ASM - ClassReader 与 Java ClassFile 文件格式</span>
        </a>
      </span>
      
      
      <span class="button next">
        <a href="https://dormouse-none.github.io/posts/2018-01-15-spring-jdbc-code-reading/">
          <span class="button__text">Spring JDBC 源码学习</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>2018-2019 © ffutop</span>
        <span>:: Powered by <a href="http://gohugo.io">Hugo</a></span>
      </div>
    
  </div>
</footer>

<script src="https://dormouse-none.github.io/assets/main.js"></script>
<script src="https://dormouse-none.github.io/assets/prism.js"></script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>






  
</div>

</body>
</html>
